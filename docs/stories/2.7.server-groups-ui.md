# Story 2.7: Server Groups UI

## Status: Ready for Review

## Story

**As a** user,
**I want** a UI to create and manage server groups,
**so that** I can organize my fleet logically.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Groups page at `/groups` route |
| 2 | Group list: Name, Description, Server Count, Actions |
| 3 | "Create Group" button opens modal: Name, Description fields |
| 4 | Click group row expands or navigates to group detail |
| 5 | Group detail shows member server list |
| 6 | "Add Servers" button opens server picker modal (multi-select) |
| 7 | Remove server from group with X button per row |
| 8 | Edit group name/description inline or via modal |
| 9 | Delete group with confirmation (warns about policy implications) |
| 10 | Empty state prompts to create first group |

## Tasks / Subtasks

- [x] Task 1: Create Groups page (AC: 1, 10)
  - [x] Create `src/pages/Groups.tsx`
  - [x] Add route in App.tsx
  - [x] Add empty state component

- [x] Task 2: Create group list component (AC: 2, 4)
  - [x] Groups displayed as cards (inline in Groups.tsx)
  - [x] Show server count per group
  - [x] Click navigates to group detail

- [x] Task 3: Create group form modal (AC: 3, 8)
  - [x] Create `src/components/groups/GroupFormModal.tsx`
  - [x] Add name, description, and color fields
  - [x] Support create and edit modes
  - [x] Zod validation for unique name

- [x] Task 4: Create group detail view (AC: 5, 7)
  - [x] Create `src/pages/GroupDetail.tsx`
  - [x] List member servers with status and hostname
  - [x] Remove button per server with confirmation

- [x] Task 5: Create server picker (AC: 6)
  - [x] Create `src/components/groups/ServerPicker.tsx`
  - [x] Multi-select with checkboxes
  - [x] Filter servers already in group
  - [x] Search servers by name/hostname

- [x] Task 6: Add delete functionality (AC: 9)
  - [x] Delete button with ConfirmDialog
  - [x] Warning about policy implications
  - [x] Refresh list after delete

## Dev Notes

### Group Hooks
```typescript
export function useGroups() {
  return useQuery({
    queryKey: ['groups'],
    queryFn: groupService.getAll,
  });
}

export function useGroup(id: string) {
  return useQuery({
    queryKey: ['groups', id],
    queryFn: () => groupService.getById(id),
    enabled: !!id,
  });
}

export function useAddServersToGroup() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: ({ groupId, serverIds }) =>
      groupService.addServers(groupId, serverIds),
    onSuccess: (_, { groupId }) => {
      queryClient.invalidateQueries(['groups', groupId]);
    },
  });
}
```

### Group Service
```typescript
export const groupService = {
  getAll: async () => {
    const { data } = await apiClient.get('/groups');
    return data;
  },
  getById: async (id: string) => {
    const { data } = await apiClient.get(`/groups/${id}`);
    return data;
  },
  create: async (input: CreateGroupInput) => {
    const { data } = await apiClient.post('/groups', input);
    return data;
  },
  addServers: async (groupId: string, serverIds: string[]) => {
    const { data } = await apiClient.post(`/groups/${groupId}/servers`, { server_ids: serverIds });
    return data;
  },
  removeServer: async (groupId: string, serverId: string) => {
    await apiClient.delete(`/groups/${groupId}/servers/${serverId}`);
  },
};
```

## Testing

### Test Requirements
- Test group list displays correctly
- Test create group modal
- Test server picker multi-select
- Test remove server from group
- Location: `frontend/tests/pages/Groups.test.tsx`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Fixed import paths (apiClient -> api, toastStore path)
- Fixed Modal prop (open -> isOpen)
- Fixed ConfirmDialog props (open -> isOpen, onCancel -> onClose, confirmText -> confirmLabel)
- Fixed type imports to use `import type` with verbatimModuleSyntax

### Completion Notes List
- Groups page with card-based list view
- Empty state with prompt to create first group
- Group cards show name, description, color dot, and server count
- Create/Edit group modal with Zod validation
- Color picker with 8 preset colors
- Group detail page with breadcrumb navigation
- Member servers table with status, hostname, added date
- Server picker modal with multi-select and search
- Select all functionality in server picker
- Remove server from group with confirmation
- Delete group with warning about policy implications
- Routes: /groups and /groups/:id

### File List
- frontend/src/services/groupService.ts (new)
- frontend/src/pages/Groups.tsx (modified - full implementation)
- frontend/src/pages/GroupDetail.tsx (new)
- frontend/src/pages/index.ts (modified - added GroupDetail export)
- frontend/src/App.tsx (modified - added /groups/:id route)
- frontend/src/components/groups/GroupFormModal.tsx (new)
- frontend/src/components/groups/ServerPicker.tsx (new)
- frontend/src/components/groups/index.ts (new)

---

## QA Results
(To be filled by QA agent)
