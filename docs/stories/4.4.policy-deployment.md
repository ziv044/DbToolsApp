# Story 4.4: Policy Deployment to Groups

## Status: Draft

## Story

**As a** user,
**I want** to deploy policies to server groups,
**so that** all servers in a group follow the same standards.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Tenant DB includes `policy_deployments` table: id, policy_id, policy_version, group_id, deployed_at, deployed_by |
| 2 | `POST /api/policies/{id}/deploy` deploys to specified group(s) |
| 3 | Request body: { group_ids: [1, 2, 3] } |
| 4 | Creates deployment record for each group |
| 5 | `GET /api/policies/{id}/deployments` returns deployment history |
| 6 | `GET /api/groups/{id}/policies` returns policies deployed to group |
| 7 | `DELETE /api/policies/{id}/deployments/{group_id}` removes deployment |
| 8 | Policy detail page shows "Deployed To" section with group list |
| 9 | "Deploy" button opens group picker modal |
| 10 | Deployment creates associated job schedule (see scheduler stories) |

## Tasks / Subtasks

- [ ] Task 1: Create PolicyDeployment model (AC: 1)
- [ ] Task 2: Create deployment API (AC: 2-7)
- [ ] Task 3: Add deployment UI (AC: 8, 9)
- [ ] Task 4: Create job on deployment (AC: 10)

## Dev Notes

### Deployment Model
```python
class PolicyDeployment(db.Model):
    __tablename__ = 'policy_deployments'
    id = db.Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    policy_id = db.Column(UUID(as_uuid=True), db.ForeignKey('policies.id'), nullable=False)
    policy_version = db.Column(db.Integer, nullable=False)
    group_id = db.Column(UUID(as_uuid=True), db.ForeignKey('server_groups.id'), nullable=False)
    deployed_at = db.Column(db.DateTime, server_default=db.func.now())
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
### Debug Log References
### Completion Notes List
### File List

---

## QA Results
