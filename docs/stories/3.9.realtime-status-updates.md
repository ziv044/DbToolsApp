# Story 3.9: Real-Time Status Updates

## Status: Draft

## Story

**As a** user,
**I want** server status to update without page refresh,
**so that** I always see current state.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Dashboard polls `/api/servers/health` every 30 seconds |
| 2 | Status changes trigger visual transition (fade/pulse animation) |
| 3 | Browser tab title shows alert count: "(3) DbTools" if 3 critical |
| 4 | Optional: Desktop notification on status change to critical (with permission) |
| 5 | Polling pauses when browser tab is hidden (visibility API) |
| 6 | Polling resumes immediately when tab becomes visible |
| 7 | Connection error shows banner, retries with exponential backoff |
| 8 | Server list view also updates status in real-time |

## Tasks / Subtasks

- [ ] Task 1: Implement polling with TanStack Query (AC: 1)
- [ ] Task 2: Add status change animations (AC: 2)
- [ ] Task 3: Update browser tab title (AC: 3)
- [ ] Task 4: Add visibility API handling (AC: 5, 6)
- [ ] Task 5: Add error handling with retry (AC: 7)
- [ ] Task 6: Optional: Add notifications (AC: 4)

## Dev Notes

### Polling with Visibility
```typescript
const { data } = useQuery({
  queryKey: ['servers', 'health'],
  queryFn: serverService.getHealth,
  refetchInterval: (query) => {
    // Pause when tab is hidden
    return document.visibilityState === 'visible' ? 30_000 : false;
  },
});

useEffect(() => {
  const handler = () => {
    if (document.visibilityState === 'visible') {
      queryClient.invalidateQueries(['servers', 'health']);
    }
  };
  document.addEventListener('visibilitychange', handler);
  return () => document.removeEventListener('visibilitychange', handler);
}, []);
```

### Tab Title Update
```typescript
useEffect(() => {
  const critical = servers.filter(s => s.status === 'critical').length;
  document.title = critical > 0 ? `(${critical}) DbTools` : 'DbTools';
}, [servers]);
```

## Testing

- Test polling occurs
- Test visibility pause/resume
- Test tab title updates

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
### Debug Log References
### Completion Notes List
### File List

---

## QA Results
