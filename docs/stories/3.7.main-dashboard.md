# Story 3.7: Main Dashboard UI

## Status: Ready for Review

## Story

**As a** user,
**I want** a dashboard showing fleet health at a glance,
**so that** I can quickly identify servers needing attention.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Dashboard is the default landing page after tenant selection |
| 2 | Summary cards: Total Servers, Healthy, Warning, Critical, Offline |
| 3 | Cards are clickable - filter server list by that status |
| 4 | Server status grid/list showing all servers with status indicators |
| 5 | Color coding: Green (healthy), Yellow (warning), Red (critical), Gray (offline) |
| 6 | Auto-refresh every 30 seconds (configurable) |
| 7 | Manual refresh button |
| 8 | Group summary section: health breakdown per group |
| 9 | "Last updated" timestamp displayed |
| 10 | Empty state with prompt to add servers if none exist |

## Tasks / Subtasks

- [x] Task 1: Create Dashboard page (AC: 1, 10)
- [x] Task 2: Create summary cards (AC: 2, 3)
- [x] Task 3: Create server status grid (AC: 4, 5)
- [x] Task 4: Add auto-refresh (AC: 6, 7, 9)
- [ ] Task 5: Create group summary (AC: 8) - Deferred: requires group health API

## Dev Notes

### Dashboard Hook
```typescript
export function useDashboard() {
  return useQuery({
    queryKey: ['dashboard'],
    queryFn: async () => {
      const health = await apiClient.get('/servers/health');
      return health.data;
    },
    refetchInterval: 30_000,
  });
}
```

### Summary Calculation
```typescript
const summary = useMemo(() => {
  const counts = { total: 0, healthy: 0, warning: 0, critical: 0, offline: 0 };
  servers.forEach(s => {
    counts.total++;
    counts[s.status]++;
  });
  return counts;
}, [servers]);
```

## Testing

- Test dashboard displays summary
- Test auto-refresh
- Test card navigation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Fixed TypeScript type imports for verbatimModuleSyntax
- Fixed Badge component to use `variant` prop instead of `color`

### Completion Notes List
- Created healthService.ts for frontend API calls:
  - getAllHealth(): Fetch health status for all servers
  - getServerHealth(): Fetch health for single server
  - getThresholds(): Get configurable thresholds
  - updateThresholds(): Update thresholds
  - calculateSummary(): Calculate health summary counts
- Rebuilt Dashboard.tsx with full monitoring UI:
  - Summary cards showing Total, Healthy, Warning, Critical, Offline, Unknown counts
  - Clickable cards that filter server list by status
  - Server status grid with color-coded cards
  - Color coding: Green (healthy), Yellow (warning), Red (critical), Gray (offline/unknown)
  - Auto-refresh configurable (15s, 30s, 1m, 5m, or off)
  - Manual refresh button
  - "Last updated" timestamp
  - Empty state prompting to add servers
  - Server cards show CPU, Memory, Connection count
  - Click to navigate to server detail
- Task 5 (Group summary) deferred - requires group health aggregation API
- Frontend builds successfully

### File List
- frontend/src/services/healthService.ts (new)
- frontend/src/pages/Dashboard.tsx (modified - complete rebuild)

---

## QA Results
