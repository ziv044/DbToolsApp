# Story 4.3: Policy UI - List & Create

## Status: Ready for Review

## Story

**As a** user,
**I want** an interface to view and create policies,
**so that** I can manage my operational standards.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Policies page at `/policies` route |
| 2 | Policy list table: Name, Type, Version, Status (active/inactive), Deployed To (count), Actions |
| 3 | "Create Policy" button opens wizard/modal |
| 4 | Step 1: Select policy type from cards with descriptions |
| 5 | Step 2: Name, description, type-specific configuration form |
| 6 | Dynamic form fields based on policy type schema |
| 7 | Form validation with inline errors |
| 8 | "Save as Draft" and "Save & Activate" options |
| 9 | Success notification with link to policy detail |
| 10 | Filter/search by policy type and name |

## Tasks / Subtasks

- [x] Task 1: Create Policies page (AC: 1, 10)
- [x] Task 2: Create policy list (AC: 2)
- [x] Task 3: Create policy wizard (AC: 3, 4, 5)
- [x] Task 4: Create dynamic form (AC: 6, 7)
- [x] Task 5: Implement save flow (AC: 8, 9)

## Dev Notes

### Dynamic Form
```typescript
const PolicyConfigForm = ({ type, schema }) => {
  const fields = Object.entries(schema.properties);
  return (
    <>
      {fields.map(([key, config]) => (
        <FormField key={key} name={key} {...config} />
      ))}
    </>
  );
};
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- No issues encountered during development

### Completion Notes List
- Created `frontend/src/services/policyService.ts` with:
  - TypeScript types: Policy, PolicyType, CreatePolicyInput, PolicySchema, PoliciesResponse
  - POLICY_TYPE_LABELS, POLICY_TYPE_DESCRIPTIONS, POLICY_TYPE_ICONS constants
  - policyService object with getAll, getById, create, update, delete, getSchemas methods
- Updated `frontend/src/pages/Policies.tsx` with full-featured UI:
  - Policy list table with Name, Type, Version, Status, Deployed To columns
  - Row actions: View and Delete buttons
  - Filter dropdown by policy type
  - Search input by name
  - "Create Policy" button opening modal
  - Empty state with create button
  - Loading spinner during fetch
  - Bulk delete functionality
- Created `frontend/src/components/policies/CreatePolicyModal.tsx`:
  - 3-step wizard: Type Selection → Configuration → Review
  - Step indicator with checkmarks for completed steps
  - Type selection cards with icons and descriptions
  - Dynamic configuration form based on policy type schema:
    - Dropdown selects for enum fields (backup_type, check_type)
    - Checkboxes for boolean fields
    - Textarea for script_content field
    - Number/text inputs for other fields
  - Form validation with inline error display
  - "Save as Draft" and "Save & Activate" buttons
  - Success toast and navigation to policy detail on create
- Created `frontend/src/components/policies/index.ts` for exports
- Frontend builds successfully

### File List
- frontend/src/services/policyService.ts (new)
- frontend/src/pages/Policies.tsx (modified)
- frontend/src/components/policies/CreatePolicyModal.tsx (new)
- frontend/src/components/policies/index.ts (new)

---

## QA Results
