# Story 4.1: Policy Data Model & API

## Status: Draft

## Story

**As a** user,
**I want** to create and manage reusable policies,
**so that** I can standardize operations across my SQL Server fleet.

## Acceptance Criteria

| # | Criteria |
|---|----------|
| 1 | Tenant DB includes `policies` table: id, name, type, description, configuration (JSON), version, is_active, created_at, updated_at |
| 2 | Policy types: backup, index_maintenance, integrity_check, custom_script |
| 3 | `POST /api/policies` creates new policy |
| 4 | `GET /api/policies` returns all policies with version info |
| 5 | `GET /api/policies/{id}` returns policy with full configuration |
| 6 | `PUT /api/policies/{id}` creates new version (immutable versioning) |
| 7 | `DELETE /api/policies/{id}` soft-deletes policy |
| 8 | Policy name must be unique within tenant |
| 9 | Configuration schema varies by type (validated on save) |
| 10 | `GET /api/policies/{id}/versions` returns version history |

## Tasks / Subtasks

- [ ] Task 1: Create Policy model (AC: 1, 2, 8)
- [ ] Task 2: Create policy repository and service
- [ ] Task 3: Implement versioning logic (AC: 6, 10)
- [ ] Task 4: Create API endpoints (AC: 3-7)
- [ ] Task 5: Add configuration validation (AC: 9)

## Dev Notes

### Policy Model
```python
class Policy(db.Model):
    __tablename__ = 'policies'
    id = db.Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    name = db.Column(db.String(255), nullable=False, unique=True)
    type = db.Column(db.String(50), nullable=False)  # backup, maintenance, etc.
    description = db.Column(db.Text)
    configuration = db.Column(db.JSON, nullable=False, default=dict)
    version = db.Column(db.Integer, nullable=False, default=1)
    is_active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime, server_default=db.func.now())
    updated_at = db.Column(db.DateTime, onupdate=db.func.now())
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | PM (John) |

---

## Dev Agent Record

### Agent Model Used
### Debug Log References
### Completion Notes List
### File List

---

## QA Results
